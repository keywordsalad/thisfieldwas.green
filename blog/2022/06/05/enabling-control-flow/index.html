<!doctype html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>

<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Remember functors? They are structures that abstract away complexity imposed by nondeterminism present in contexts that produce some output; contexts such as optionality, network interaction, or validation. When contexts fail to produce some output, they are in their undesired case and no computation may be performed against them. In this post we will explore how to exploit this characteristic to halt computation in order to express control flow."><title>Enabling Control Flow in Functional Programming - This Field Was Green</title>
<link rel="canonical" href="https://thisfieldwas.green/blog/2022/06/05/enabling-control-flow/">
<link rel="shortcut icon" sizes="16x16 32x32 48x48 64x64 96x96 128x128 256x256" href="https://thisfieldwas.green/favicon.ico">

<meta property="og:site_name" content="">
<meta property="og:title" content="Enabling Control Flow in Functional Programming">
<meta property="og:url" content="https://thisfieldwas.green/blog/2022/06/05/enabling-control-flow/">
<meta property="og:description" content="Remember functors? They are structures that abstract away complexity imposed by nondeterminism present in contexts that produce some output; contexts such as optionality, network interaction, or validation. When contexts fail to produce some output, they are in their undesired case and no computation may be performed against them. In this post we will explore how to exploit this characteristic to halt computation in order to express control flow.">
<meta property="og:image:url" content="https://thisfieldwas.green/images/tags/functional-programming/functional-grass-512x512.png">
<meta property="og:image:alt" content="Leveraging the effects of two or more contexts to allow computations to proceed or halt.">
<meta property="article:published_time" content="2022-06-05T14:01:07-07:00">
  <meta property="article:modified_time" content="2022-06-05T14:01:07-07:00">
  <meta property="article:author" content="Logan McGrath">
  <meta property="article:tag" content="functional programming">
  <meta property="article:tag" content="programming">
  <meta property="article:tag" content="scala">
  <meta property="article:tag" content="design patterns">
  <meta property="article:tag" content="contexts">
  
<link rel="stylesheet" href="/css/main.css">
<script src="/js/main.js" async></script>
<script src="/js/scroll-shadows.js" async></script>
<script>
  let scrollShadowsXSelectors = ["pre.sourceCode",]
  let scrollShadowsYSelectors = []
  window.addEventListener("load", () => {
    scrollShadowsXSelectors.forEach(updateScrollShadowsXSelector)
    scrollShadowsYSelectors.forEach(updateScrollShadowsYSelector)
  })
  window.addEventListener("resize", () => {
    scrollShadowsXSelectors.forEach(updateScrollShadowsXSelector)
  })
</script>


</head>
<body>

<header class="page-header">
  <div class="content-bound">
    <div class="logo-icon"><a href="/" tabindex="-1" title="This Field Was Green"></a></div>
    <div class="logo-nav">
      <h1 class="logo"><a href="/">This Field Was Green</a></h1>
      <nav class="main-nav">
  <a href="/">Home</a>
  <a href="/blog/">Blog</a>
  <a href="/resume/">Resume</a>
  <a href="/contact/">Contact</a>
</nav>

    </div>
  </div>
</header>

<main class="page-content">
  <div class="content-bound">
    <div class="post post-full">
      <h1 class="post-title">Enabling Control Flow in Functional Programming</h1>
<div class="post-meta">
  <p class="post-published">
    Posted on June  5, 2022
    by Logan McGrath
    </p>
  <p class="post-tags">
      Tags: <a class="tag" href="/tags/functional-programming">functional programming</a>, <a class="tag" href="/tags/programming">programming</a>, <a class="tag" href="/tags/scala">scala</a>, <a class="tag" href="/tags/design-patterns">design patterns</a>, <a class="tag" href="/tags/contexts">contexts</a>
    </p>
  </div>

<div class="post-thumbnail">
  <a href="/images/tags/functional-programming/functional-grass-128x128.png">
    <img src="/images/tags/functional-programming/functional-grass-128x128.png" alt="Enabling Control Flow in Functional Programming" width="128" height="128" loading="lazy">
  </a>
</div>

<div class="estimated-reading-time">
<p>Estimated reading time: <span class="length">32m 5s</span></p>
</div>
<p>Remember <strong>functors</strong>? Recall from my last post, <a href="/blog/2022/03/15/contexts-and-effects/" title="Contexts and Effects in Functional Programming">Contexts and Effects in Functional Programming</a>, they are structures that abstract away complexity imposed by nondeterminism present in <strong>contexts</strong> that produce some output; contexts such as optionality, network interaction, or validation. When contexts fail to produce some output, they are in their <strong>undesired case</strong> and no computation may be performed against them. In this post we will explore how to exploit this characteristic to halt computation in order to express control flow.</p>
<!--more-->
<blockquote>
<p><strong>This post is part of a series:</strong></p>
<ol type="1">
<li><a href="/blog/2022/03/15/contexts-and-effects/" title="Contexts and Effects in Functional Programming">Contexts and Effects in Functional Programming</a></li>
<li><strong>Enabling Control Flow in Functional Programming</strong></li>
<li><a href="/blog/2022/06/17/imperative-computation/" title="Imperative Computation in Functional Programming">Imperative Computation in Functional Programming</a></li>
</ol>
</blockquote>
<p><em>The code that accompanies this post may be found <a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2" title="Accompanying code repository">here</a>.</em></p>
<h2 id="motivating-applicative-functors-as-a-design-pattern">Motivating applicative functors as a design pattern</h2>
<p>Recall the <code>Functor</code> typeclass:</p>
<div class="numberLines">
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> Functor<span class="op">[</span>F<span class="op">[</span>_<span class="op">]]</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> map<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">])(</span>f<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">):</span> F<span class="op">[</span>B<span class="op">]</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Functor <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> apply<span class="op">[</span>F<span class="op">[</span>_<span class="op">]:</span> Functor<span class="op">]:</span> Functor<span class="op">[</span>F<span class="op">]</span> <span class="op">=</span> implicitly<span class="op">[</span>Functor<span class="op">[</span>F<span class="op">]]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Functor.scala">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>For any context <code>F[A]</code>, the <code>map()</code> function accepts another function <code>f: A =&gt; B</code> and applies it to the term within the context, giving back <code>F[B]</code>.</p>
<p>Contexts that are functors thus allow abstraction over unknown cases. For example, a function <code>f: A =&gt; B</code> may be lifted into an <code>Option[A]</code> and applied if an instance of <code>A</code> is present. If no instance of <code>A</code> is present, then nothing happens. Specifically, by using <code>map()</code> the function <code>f</code> is unconcerned with the unknown quantity of <code>A</code>’s presence. Many contexts encode dimensions of unknown quantities, and as functors they completely abstract the nondeterminism of these quantities, allowing the business logic expressed by the lifted functions to focus only on the terms that they operate against.</p>
<p>What this means is that for any context in the <strong>desired case</strong>, such as a <code>Some</code> of <code>Option[A]</code> or a <code>Right</code> of <code>Either[X, A]</code>, the function <code>f</code> will be applied when lifted with <code>map()</code>. Any number of functions may be applied to the new contexts returned by subsequent applications of <code>map()</code>, and they will all apply as the initial context was in the <strong>desired case</strong>. Functors thus may be considered as enablers of data transformation, as lifted functions transform data if it exists. But if the initial context is in an <strong>undesired case</strong>, none of the lifted functions will apply.</p>
<p>Functions lifted into a context are permitted to compute if the context is in the <strong>desired case</strong>. But if a function is lifted into a context that is in the <strong>undesired case</strong>, then computation is halted. This means that the case of any context may control the flow of execution within a program.</p>
<p>You can try for yourself from the sample repository’s <code>sbt console</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb2"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="op">:</span>load console<span class="op">/</span>imports<span class="op">.</span>scala</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="kw">val</span> desiredOption<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">Some</span><span class="op">(</span><span class="dv">42</span><span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> desiredOption<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">Some</span><span class="op">(</span><span class="dv">42</span><span class="op">)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> desiredOption<span class="op">.</span><span class="fu">map</span><span class="op">(</span>_<span class="op">.</span>toString<span class="op">).</span><span class="fu">map</span><span class="op">(</span>numStr <span class="op">=&gt;</span> <span class="ss">s&quot;</span><span class="st">backwards: </span><span class="ss">${</span>numStr<span class="op">.</span>reverse<span class="ss">}&quot;</span><span class="op">)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>res0<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="ex">String</span><span class="op">]</span> <span class="op">=</span> <span class="bu">Some</span><span class="op">(</span>backwards<span class="op">:</span> <span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="kw">val</span> undesiredOption<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">None</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> undesiredOption<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">None</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> undesiredOption<span class="op">.</span><span class="fu">map</span><span class="op">(</span>_<span class="op">.</span>toString<span class="op">).</span><span class="fu">map</span><span class="op">(</span>numStr <span class="op">=&gt;</span> <span class="ss">s&quot;</span><span class="st">backwards: </span><span class="ss">${</span>numStr<span class="op">.</span>reverse<span class="ss">}&quot;</span><span class="op">)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>res1<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="ex">String</span><span class="op">]</span> <span class="op">=</span> <span class="bu">None</span></span></code></pre></div>
</div>
<p>Functors only allow lifting functions of the form <code>f: A =&gt; B</code>. The context can’t be modified with a function having this signature, which means we can’t use a functor specifically to influence control flow by injecting a context in its <strong>undesired case</strong>. Functors respect the <em>existing case</em> of a context: they cannot modify it.</p>
<h2 id="introducing-control-flow">Introducing control flow</h2>
<p>What function might allow for control flow using contexts? There is one, <code>map2()</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb3"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map2<span class="op">[</span>F<span class="op">[</span>_<span class="op">],</span> A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">],</span> fb<span class="op">:</span> F<span class="op">[</span>B<span class="op">])(</span>f<span class="op">:</span> <span class="op">(</span>A<span class="op">,</span> B<span class="op">)</span> <span class="op">=&gt;</span> C<span class="op">):</span> F<span class="op">[</span>C<span class="op">]</span></span></code></pre></div>
</div>
<p>This two-argument analog of <code>map()</code> unlocks a key capability: controlling whether to proceed or halt computation against the terms contained within the contexts <code>fa</code> and <code>fb</code>. If both <code>fa</code> and <code>fb</code> are in their <strong>desired case</strong>, then there are instances of <code>A</code> and <code>B</code> against which the function <code>f</code> may be applied. But if either one or both are in their <strong>undesired case</strong>, then <code>f</code> does not apply, and the <strong>undesired cases</strong> are <em>propagated</em> through <code>F[C]</code>. This means that <code>fa</code> and <code>fb</code> become <em>levers</em> with which to halt computation that would be performed using function <code>f</code> and subsequent computation against context <code>F[C]</code>.</p>
<p>Take for example addition lifted into the context of <code>Option[Int]</code> within the sample repository’s <code>sbt console</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb4"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="op">:</span>load console<span class="op">/</span>imports<span class="op">.</span>scala</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="kw">val</span> F <span class="op">=</span> Applicative<span class="op">[</span><span class="ex">Option</span><span class="op">]</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> F<span class="op">:</span> Applicative<span class="op">[</span><span class="ex">Option</span><span class="op">]</span> <span class="op">=</span> Option$Instances$$anon$<span class="dv">1</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> F<span class="op">.</span><span class="fu">map2</span><span class="op">(</span><span class="ex">Option</span><span class="op">(</span><span class="dv">2</span><span class="op">),</span> <span class="ex">Option</span><span class="op">(</span><span class="dv">2</span><span class="op">))(</span>_ <span class="op">+</span> _<span class="op">)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> res0<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">Some</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> F<span class="op">.</span><span class="fu">map2</span><span class="op">(</span><span class="ex">Option</span><span class="op">(</span><span class="dv">2</span><span class="op">),</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]())(</span>_ <span class="op">+</span> _<span class="op">)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> res1<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">None</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> F<span class="op">.</span><span class="fu">map2</span><span class="op">(</span><span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">](),</span> <span class="ex">Option</span><span class="op">(</span><span class="dv">2</span><span class="op">))(</span>_ <span class="op">+</span> _<span class="op">)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> res2<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">None</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> F<span class="op">.</span><span class="fu">map2</span><span class="op">(</span><span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">](),</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]())(</span>_ <span class="op">+</span> _<span class="op">)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> res3<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">]</span> <span class="op">=</span> <span class="bu">None</span></span></code></pre></div>
</div>
<p>Only when both arguments are in their <strong>desired case</strong> does the function of addition apply. If either or both arguments are in their <strong>undesired case</strong>, then the <strong>undesired case</strong> is <em>propagated</em>. This does not allow the function to apply, and halts any further operations against the context. <em>The functions that produce the two input contexts are thus capable of controlling whether computation via <code>f</code> proceeds and permits further computation against the context <code>F[C]</code>.</em></p>
<h2 id="applicative-functors">Applicative functors</h2>
<p>The <code>map2()</code> function is implemented using a new structure, a specialization of a functor called an <strong>applicative functor</strong>, or simply an <em>applicative</em>.</p>
<p>Applicative functors as a specialization arise in the type of <code>A</code> contained within a functor <code>F[_]</code>. If <code>A</code> is merely an opaque type, then <code>F[A]</code> is a functor and no more. But if <code>A</code> is specifically known to have some type <code>A =&gt; B</code>, that is to say <em><code>A</code> is a function</em>, then <code>F[A =&gt; B]</code> is an <em>applicative</em> functor.</p>
<p>Applicatives define two functions from which many more are derived, including <code>map2()</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb5"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> Applicative<span class="op">[</span>F<span class="op">[</span>_<span class="op">]]</span> <span class="kw">extends</span> Functor<span class="op">[</span>F<span class="op">]</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> F<span class="op">[</span>A<span class="op">]</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> F<span class="op">[</span>A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">]):</span> F<span class="op">[</span>B<span class="op">]</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// other functions are introduced below</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Applicative <span class="op">{</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> apply<span class="op">[</span>F<span class="op">:</span> Applicative<span class="op">]:</span> Applicative<span class="op">[</span>F<span class="op">]</span> <span class="op">=</span> implicitly<span class="op">[</span>Applicative<span class="op">[</span>F<span class="op">]]</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/control/Applicative.scala">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>Note that <code>Applicative</code> extends <code>Functor</code> as it is a specialization. All applicatives are also functors and therefore also provide the <code>map()</code> function.</p>
<p>The new functions defined by applicatives offer two capabilities:</p>
<ul>
<li><code>pure()</code> which lifts the result of a pure computation <code>A</code> into the context such that <code>pure: A =&gt; F[A]</code>. This is essentially a constructor producing a context in the <strong>desired case</strong>, such as <code>Some</code> for <code>Option[A]</code> or <code>Right</code> for <code>Either[X, A]</code>. In short, <code>pure()</code> puts <code>A</code> in the box.</li>
<li><code>ap()</code>, read as <em>apply</em>, for applying a lifted function to a lifted argument. Given two boxes, if the first contains a function and the second contains an argument, <code>ap()</code> will apply them and put them back in the box.</li>
</ul>
<p>You might be wondering why a function would ever be lifted into a context? I will demonstrate why this is desirable in how <code>ap()</code> works by defining <code>map2()</code> within <code>Applicative</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb6"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map2<span class="op">[</span>A<span class="op">,</span> B<span class="op">,</span> C<span class="op">](</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">],</span> fb<span class="op">:</span> F<span class="op">[</span>B<span class="op">])(</span>f<span class="op">:</span> <span class="op">(</span>A<span class="op">,</span> B<span class="op">)</span> <span class="op">=&gt;</span> C<span class="op">):</span> F<span class="op">[</span>C<span class="op">]</span> <span class="op">=</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ap</span><span class="op">(</span><span class="fu">ap</span><span class="op">(</span><span class="fu">pure</span><span class="op">(</span>f<span class="op">.</span>curried<span class="op">))(</span>fa<span class="op">))(</span>fb<span class="op">)</span></span></code></pre></div>
</div>
<p>Lifting <code>f</code> into the context works following these steps:</p>
<ol type="1">
<li>By currying the function <code>f: (A, B) =&gt; C</code>, it becomes <code>A =&gt; B =&gt; C</code>.</li>
<li>Lifting it with <code>pure()</code> gives <code>F[A =&gt; B =&gt; C]</code> in the <strong>desired case</strong>, which gives us a clean slate to start our computation with.</li>
<li>Then, with <code>ap()</code> we may apply the first argument <code>fa: F[A]</code> which will give back <code>F[B =&gt; C]</code> in the <strong>desired case</strong> <em>if <code>fa</code> is itself in the desired case</em>.</li>
<li>Then, with <code>ap()</code> we may apply the second argument <code>fb: F[B]</code> which will give back <code>F[C]</code> in the <strong>desired case</strong> <em>if <code>fb</code> is itself in the desired case</em>.</li>
</ol>
<p>Each step of lifted function application accounts for the case of the function and argument contexts and halts if either context is in the <strong>undesired case</strong>. The <strong>undesired case</strong> will <em>propagate instead</em> through <code>F[C]</code> if and when it exists.</p>
<p>You might have noticed, <code>map2()</code> looks an awful lot like <code>map()</code>. In fact, <code>Applicative</code> provides a default implementation of <code>map()</code> following the same pattern:</p>
<div class="numberLines">
<div class="sourceCode" id="cb7"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">])(</span>f<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">):</span> F<span class="op">[</span>B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ap</span><span class="op">(</span><span class="fu">pure</span><span class="op">(</span>f<span class="op">))(</span>fa<span class="op">)</span></span></code></pre></div>
</div>
<p>If your context implements <code>Applicative</code>, then it also implements <code>Functor</code> with no extra work. You can always provide your own implementation of <code>map()</code> if it is more efficient to do so.</p>
<h2 id="validation-as-a-use-case">Validation as a use case</h2>
<p>Let’s walk through a powerful capability of applicatives: <em>validation</em>.</p>
<h3 id="validating-a-user-from-external-data">Validating a <code>User</code> from external data</h3>
<p>When constructing a <code>User</code> from data that we receive from an external source, such as a form or API, we can use <code>ap()</code> to lift <code>User</code>’s curried constructor into a validation context and apply it to validated arguments. If all arguments are valid, then we should receive a validation context containing a valid <code>User</code>. If any arguments are invalid, then we should receive an invalid context with all reasons for validation failure.</p>
<p>Here is the definition for <code>User</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb8"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">User</span><span class="op">(</span>username<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> email<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> password<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Each of <code>username</code>, <code>email</code>, and <code>password</code> must to be valid in order for <code>User</code> itself to be valid. This requires the introduction of a validation context:</p>
<div class="numberLines">
<div class="sourceCode" id="cb9"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sealed</span> <span class="kw">trait</span> Validated<span class="op">[+</span>E<span class="op">,</span> <span class="op">+</span>A<span class="op">]</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> invalid<span class="op">:</span> E</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> valid<span class="op">:</span> A</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> Valid<span class="op">[+</span>A<span class="op">](</span>valid<span class="op">:</span> A<span class="op">)</span> <span class="kw">extends</span> Validated<span class="op">[</span>Nothing<span class="op">,</span> A<span class="op">]</span> <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> invalid<span class="op">:</span> Nothing <span class="op">=</span> <span class="cf">throw</span> <span class="kw">new</span> <span class="ex">NoSuchElementException</span><span class="op">(</span><span class="st">&quot;Valid.invalid&quot;</span><span class="op">)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">Invalid</span><span class="op">[+</span>E<span class="op">](</span>invalid<span class="op">:</span> E<span class="op">)</span> <span class="kw">extends</span> Validated<span class="op">[</span>E<span class="op">,</span> Nothing<span class="op">]</span> <span class="op">{</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> valid<span class="op">:</span> Nothing <span class="op">=</span> <span class="cf">throw</span> <span class="kw">new</span> <span class="ex">NoSuchElementException</span><span class="op">(</span><span class="st">&quot;Invalid.valid&quot;</span><span class="op">)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Validated.scala">See here</a> for the definitions in the sample repository.</p>
</blockquote>
<h4 id="why-use-a-new-validated-context-instead-of-either">Why use a new <code>Validated</code> context instead of <code>Either</code>?</h4>
<p>The <code>Applicative</code> instance for <code>Either</code> in the context of validation has one key flaw: it short-circuits on the first <code>Left</code>.</p>
<p>Refer to <code>Either</code>’s implementation of <code>ap()</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb10"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">override</span> <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> Either<span class="op">[</span>X<span class="op">,</span> A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> Either<span class="op">[</span>X<span class="op">,</span> A<span class="op">]):</span> Either<span class="op">[</span>X<span class="op">,</span> B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>ff<span class="op">,</span> fa<span class="op">)</span> <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="op">(</span><span class="fu">Right</span><span class="op">(</span>f<span class="op">),</span> <span class="fu">Right</span><span class="op">(</span>a<span class="op">))</span> <span class="op">=&gt;</span> <span class="fu">Right</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span>a<span class="op">))</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="op">(</span><span class="fu">Left</span><span class="op">(</span>x<span class="op">),</span> _<span class="op">)</span>         <span class="op">=&gt;</span> <span class="fu">Left</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="op">(</span>_<span class="op">,</span> <span class="fu">Left</span><span class="op">(</span>x<span class="op">))</span>         <span class="op">=&gt;</span> <span class="fu">Left</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Either.scala#L145-L150">See here</a> for <code>Either</code>’s definition of <code>ap()</code>.</p>
</blockquote>
<p>For both cases of <code>Left</code> they are immediately returned and there is no specific handling for situations where both <code>ff</code> and <code>fa</code> may be in the <code>Left</code> case. This means that the first <code>Left</code> propagates and all subsequent <code>Left</code>s are swallowed. In the context of validation, this means that for any number of validation errors that the context might produce, we would only receive the first error. We would have to resolve the error and re-run the operation, and repeat for each subsequent error until the operation as a whole succeeded. This makes <code>Either</code> a very poor choice for modeling validation. It represents strictly one thing or the other, whereas validation we can specialize to propagate all reasons for failure.</p>
<h3 id="validation-via-applicative">Validation via <code>Applicative</code></h3>
<p><code>Validated</code> contains the valid value you want or the reasons for invalidation. We could fail to receive a <code>User</code> for three or more reasons related to <code>username</code>, <code>email</code>, and <code>password</code> all being invalid, which implies that term <code>E</code> represents some data containing one or more of <em>something</em>. This has a specific implication on how we define an instance of <code>Applicative</code> for <code>Validated</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb11"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">def</span> validatedApplicative<span class="op">[</span>E<span class="op">]:</span> Applicative<span class="op">[</span>Validated<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">=</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> Applicative<span class="op">[</span>Validated<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> Validated<span class="op">[</span>E<span class="op">,</span> A<span class="op">]</span> <span class="op">=</span> <span class="fu">Valid</span><span class="op">(</span>a<span class="op">)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> Validated<span class="op">[</span>E<span class="op">,</span> A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> Validated<span class="op">[</span>E<span class="op">,</span> A<span class="op">]):</span> Validated<span class="op">[</span>E<span class="op">,</span> B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>ff<span class="op">,</span> fa<span class="op">)</span> <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="fu">Valid</span><span class="op">(</span>f<span class="op">),</span> <span class="fu">Valid</span><span class="op">(</span>a<span class="op">))</span> <span class="op">=&gt;</span> <span class="fu">Valid</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span>a<span class="op">))</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>x<span class="op">),</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">))</span> <span class="op">=&gt;</span> <span class="op">???</span> <span class="co">/* what do we do with these two E&#39;s? */</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>x<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span>_<span class="op">,</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">))</span> <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">)</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div>
</div>
<p>When there are two instances of <code>E</code> we don’t have a way to combine them as <code>E</code> is an opaque type. Without concretely defining <code>E</code>, such as with <code>List[String]</code> or another similar structure, we won’t be able to combine their values, but this creates an inflexible API. Specifically, this inability to combine <code>E</code> leaves <code>Validated</code> in the same position that <code>Either</code> is in: the <em>first</em> <strong>undesired case</strong> propagates and subsequent cases are <em>swallowed</em>. How do we <em>combine</em> the <strong>undesired cases</strong>?</p>
<h3 id="modeling-combinable-structures">Modeling combinable structures</h3>
<p>Structures defining a <code>combine()</code> function form a typeclass known as a <strong>semigroup</strong> under a specific condition: that <code>combine()</code> is associative. Semigroups are very common, and constraining <code>E</code> to have an instance of <code>Semigroup</code> provides great API flexibility. First, let’s see how the <code>Semigroup</code> typeclass is defined:</p>
<div class="numberLines">
<div class="sourceCode" id="cb12"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> Semigroup<span class="op">[</span>A<span class="op">]</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">combine</span><span class="op">(</span>left<span class="op">:</span> A<span class="op">,</span> right<span class="op">:</span> A<span class="op">):</span> A</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Semigroup <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> apply<span class="op">[</span>A<span class="op">:</span> Semigroup<span class="op">]:</span> Semigroup<span class="op">[</span>A<span class="op">]</span> <span class="op">=</span> <span class="kw">implicit</span><span class="op">[</span>Semigroup<span class="op">[</span>A<span class="op">]]</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Semigroup.scala">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>A semigroup is thus an additive form of data. Here’s a few familiar data types that you may have used as semigroups without realizing it:</p>
<ul>
<li><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/stdlib/ListSpec.scala#L51">Lists under concatenation</a></li>
<li><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/stdlib/StringSpec.scala#L22">Strings under concatenation</a></li>
<li><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/stdlib/IntegerSpec.scala#L17">Integers under addition</a></li>
<li><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/stdlib/BooleanSpec.scala#L12">Booleans under <code>&amp;&amp;</code></a></li>
<li><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/stdlib/SetSpec.scala#L33">Sets under union</a></li>
</ul>
<p>The <code>combine()</code> function must be associative. This can be tested with a <code>scalacheck</code> property:</p>
<div class="numberLines">
<div class="sourceCode" id="cb13"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> checkSemigroupLaws<span class="op">[</span>S<span class="op">:</span> Semigroup<span class="op">:</span> Arbitrary<span class="op">]():</span> <span class="bu">Unit</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> green<span class="op">.</span>thisfieldwas<span class="op">.</span>embracingnondeterminism<span class="op">.</span>syntax<span class="op">.</span>semigroup<span class="op">.</span>_</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">property</span><span class="op">(</span><span class="st">&quot;Semigroup preserves associativity&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">forAll</span><span class="op">(</span><span class="cf">for</span> <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      a <span class="op">&lt;-</span> arbitrary<span class="op">[</span>S<span class="op">]</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      b <span class="op">&lt;-</span> arbitrary<span class="op">[</span>S<span class="op">]</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      c <span class="op">&lt;-</span> arbitrary<span class="op">[</span>S<span class="op">]</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">yield</span> <span class="op">(</span>a<span class="op">,</span> b<span class="op">,</span> c<span class="op">))</span> <span class="op">{</span> <span class="cf">case</span> <span class="op">(</span>a<span class="op">,</span> b<span class="op">,</span> c<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>a <span class="op">|+|</span> b<span class="op">)</span> <span class="op">|+|</span> c mustBe a <span class="op">|+|</span> <span class="op">(</span>b <span class="op">|+|</span> c<span class="op">)</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/SemigroupLaws.scala">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>Given an <code>E</code> with an instance of <code>Semigroup</code>, we can define an <code>Applicative</code> instance for <code>Validated</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb14"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">def</span> validatedApplicative<span class="op">[</span>E<span class="op">:</span> Semigroup<span class="op">]:</span> Applicative<span class="op">[</span>Validated<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">=</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> Applicative<span class="op">[</span>Validated<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> Semigroup<span class="op">.</span>Syntax<span class="op">.</span>_</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> Validated<span class="op">[</span>E<span class="op">,</span> A<span class="op">]</span> <span class="op">=</span> <span class="fu">Valid</span><span class="op">(</span>a<span class="op">)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> Validated<span class="op">[</span>E<span class="op">,</span> A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> Validated<span class="op">[</span>E<span class="op">,</span> A<span class="op">]):</span> Validated<span class="op">[</span>E<span class="op">,</span> B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>ff<span class="op">,</span> fa<span class="op">)</span> <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="fu">Valid</span><span class="op">(</span>f<span class="op">),</span> <span class="fu">Valid</span><span class="op">(</span>a<span class="op">))</span>     <span class="op">=&gt;</span> <span class="fu">Valid</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span>a<span class="op">))</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>x<span class="op">),</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">))</span> <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>x <span class="op">|+|</span> y<span class="op">)</span> <span class="co">// propagate both undesired cases via Semigroup</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>x<span class="op">),</span> _<span class="op">)</span>          <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span>_<span class="op">,</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">))</span>          <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">)</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Validated.scala#L111-L149">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>This means that <code>Validated</code> is usable as an <code>Applicative</code> for any case where <code>E</code> is combinable. What implications does this have?</p>
<ul>
<li>Errors may exist in a non-zero amount when the context is <code>Invalid</code>.</li>
<li>When there are errors, the amount is unbounded.</li>
<li>Combining errors can be frequent, and should be computationally cheap.</li>
</ul>
<p>Naively, a <code>List[String]</code> works for <code>E</code>. It forms a <code>Semigroup</code> under concatenation, but concatenation isn’t cheap in Scala <code>List</code>s. It can also be empty per its type, which means that as <code>E</code> you have to code for invariants where it is actually empty.</p>
<p>There exists a better structure, and we can whip it together pretty quick: the <code>NonEmptyChain</code>. This structure is a context modeled as two cases: either a single value, or a pair of separate instances of itself appended together. This allows for a <code>List</code>-like structure with constant-time concatenation that can be converted to a <code>Seq</code> in linear time.</p>
<div class="numberLines">
<div class="sourceCode" id="cb15"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> NonEmptyChain<span class="op">[+</span>A<span class="op">]</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> NonEmptyChain<span class="op">.</span>_</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> head<span class="op">:</span> A</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> tail<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> length<span class="op">:</span> <span class="bu">Int</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> cons<span class="op">[</span>B <span class="op">&gt;:</span> A<span class="op">](</span>newHead<span class="op">:</span> B<span class="op">):</span> NonEmptyChain<span class="op">[</span>B<span class="op">]</span> <span class="op">=</span> <span class="fu">prepend</span><span class="op">(</span><span class="fu">Singleton</span><span class="op">(</span>newHead<span class="op">))</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> prepend<span class="op">[</span>B <span class="op">&gt;:</span> A<span class="op">](</span>prefix<span class="op">:</span> NonEmptyChain<span class="op">[</span>B<span class="op">]):</span> NonEmptyChain<span class="op">[</span>B<span class="op">]</span> <span class="op">=</span> prefix<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="kw">this</span><span class="op">)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> append<span class="op">[</span>B <span class="op">&gt;:</span> A<span class="op">](</span>suffix<span class="op">:</span> NonEmptyChain<span class="op">[</span>B<span class="op">]):</span> NonEmptyChain<span class="op">[</span>B<span class="op">]</span> <span class="op">=</span> <span class="fu">Append</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> suffix<span class="op">)</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> toSeq<span class="op">:</span> <span class="bu">Seq</span><span class="op">[</span>A<span class="op">]</span> <span class="op">=</span> head <span class="op">+:</span> tail<span class="op">.</span><span class="fu">fold</span><span class="op">(</span><span class="bu">Seq</span><span class="op">[</span>A<span class="op">]())(</span>_<span class="op">.</span>toSeq<span class="op">)</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> NonEmptyChain <span class="op">{</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> apply<span class="op">[</span>A<span class="op">](</span>value<span class="op">:</span> A<span class="op">,</span> rest<span class="op">:</span> A<span class="op">*):</span> NonEmptyChain<span class="op">[</span>A<span class="op">]</span> <span class="op">=</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    rest<span class="op">.</span>map<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]](</span><span class="fu">Singleton</span><span class="op">(</span>_<span class="op">)).</span>foldLeft<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]](</span><span class="fu">Singleton</span><span class="op">(</span>value<span class="op">))(</span>_ append _<span class="op">)</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> Singleton<span class="op">[+</span>A<span class="op">](</span>head<span class="op">:</span> A<span class="op">)</span> <span class="kw">extends</span> NonEmptyChain<span class="op">[</span>A<span class="op">]</span> <span class="op">{</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> tail<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span> <span class="bu">None</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> length<span class="op">:</span> <span class="bu">Int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> Append<span class="op">[+</span>A<span class="op">](</span>prefix<span class="op">:</span> NonEmptyChain<span class="op">[</span>A<span class="op">],</span> suffix<span class="op">:</span> NonEmptyChain<span class="op">[</span>A<span class="op">])</span> <span class="kw">extends</span> NonEmptyChain<span class="op">[</span>A<span class="op">]</span> <span class="op">{</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> head<span class="op">:</span> A <span class="op">=</span> prefix<span class="op">.</span>head</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> tail<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span> prefix<span class="op">.</span>tail<span class="op">.</span><span class="fu">map</span><span class="op">(</span>suffix<span class="op">.</span>prepend<span class="op">).</span><span class="fu">orElse</span><span class="op">(</span><span class="bu">Some</span><span class="op">(</span>suffix<span class="op">))</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> length<span class="op">:</span> <span class="bu">Int</span> <span class="op">=</span> prefix<span class="op">.</span>length <span class="op">+</span> suffix<span class="op">.</span>length</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span> <span class="co">`</span>NonEmptyChain<span class="co">`</span> forms a <span class="co">`</span>Semigroup<span class="co">`</span> under the <span class="co">`</span>append<span class="co">()`</span> function<span class="co">.</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">*/</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">def</span> nonEmptyChainSemigroup<span class="op">[</span>A<span class="op">]:</span> Semigroup<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span> _ append _</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/NonEmptyChain.scala">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>Using a <code>NonEmptyChain</code>, we can start writing validation functions for <code>User</code> to test that they work:</p>
<div class="numberLines">
<div class="sourceCode" id="cb16"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> green<span class="op">.</span>thisfieldwas<span class="op">.</span>embracingnondeterminism<span class="op">.</span>syntax<span class="op">.</span>applicative<span class="op">.</span>_</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> green<span class="op">.</span>thisfieldwas<span class="op">.</span>embracingnondeterminism<span class="op">.</span>syntax<span class="op">.</span>validated<span class="op">.</span>_</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">User</span><span class="op">(</span>username<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> email<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> password<span class="op">:</span> <span class="ex">String</span><span class="op">)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">validateUsername</span><span class="op">(</span>username<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> ValidatedNec<span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="ex">String</span><span class="op">]</span> <span class="op">=</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>username<span class="op">.</span>isEmpty<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Username can&#39;t be blank&quot;</span><span class="op">.</span>invalidNec<span class="op">[</span><span class="ex">String</span><span class="op">]</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    username<span class="op">.</span>validNec<span class="op">[</span><span class="ex">String</span><span class="op">]</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">validateEmail</span><span class="op">(</span>email<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> ValidatedNec<span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="ex">String</span><span class="op">]</span> <span class="op">=</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>email<span class="op">.</span><span class="fu">contains</span><span class="op">(</span><span class="ch">&#39;@&#39;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Email does not appear to be valid&quot;</span><span class="op">.</span>invalidNec<span class="op">[</span><span class="ex">String</span><span class="op">]</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    email<span class="op">.</span>validNec<span class="op">[</span><span class="ex">String</span><span class="op">]</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">validatePassword</span><span class="op">(</span>password<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> ValidatedNec<span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="ex">String</span><span class="op">]</span> <span class="op">=</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="ex">List</span><span class="op">(</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span><span class="fu">cond</span><span class="op">(</span>password<span class="op">.</span>length <span class="op">&lt;</span> <span class="dv">8</span><span class="op">)(</span><span class="st">&quot;Password must have at least 8 characters&quot;</span><span class="op">),</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span><span class="fu">cond</span><span class="op">(!</span>password<span class="op">.</span><span class="fu">exists</span><span class="op">(</span>_<span class="op">.</span>isLower<span class="op">))(</span><span class="st">&quot;Password must contain at least one lowercase character&quot;</span><span class="op">),</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span><span class="fu">cond</span><span class="op">(!</span>password<span class="op">.</span><span class="fu">exists</span><span class="op">(</span>_<span class="op">.</span>isUpper<span class="op">))(</span><span class="st">&quot;Password must contain at least one uppercase character&quot;</span><span class="op">),</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span><span class="fu">cond</span><span class="op">(!</span>password<span class="op">.</span><span class="fu">exists</span><span class="op">(</span>_<span class="op">.</span>isDigit<span class="op">))(</span><span class="st">&quot;Password must contain at least one digit&quot;</span><span class="op">),</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Option</span><span class="op">.</span><span class="fu">cond</span><span class="op">(!</span>password<span class="op">.</span><span class="fu">exists</span><span class="op">(</span><span class="st">&quot;`~!@#$%^&amp;*()-_=+[]{}</span><span class="er">\|</span><span class="st">;:&#39;</span><span class="ch">\&quot;</span><span class="st">,.&lt;&gt;/?&quot;</span><span class="op">.</span><span class="fu">contains</span><span class="op">(</span>_<span class="op">)))(</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must contain at least one symbol&quot;</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">),</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">).</span><span class="fu">foldLeft</span><span class="op">(</span>password<span class="op">.</span>validNec<span class="op">[</span><span class="ex">String</span><span class="op">])</span> <span class="op">{</span> <span class="op">(</span>validated<span class="op">,</span> errorOption<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    errorOption<span class="op">.</span><span class="fu">fold</span><span class="op">(</span>validated<span class="op">)</span> <span class="op">{</span> message <span class="op">=&gt;</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>      <span class="ex">Invalid</span><span class="op">(</span>validated<span class="op">.</span><span class="fu">fold</span><span class="op">(</span>_<span class="op">.</span><span class="fu">cons</span><span class="op">(</span>message<span class="op">))(</span>_ <span class="op">=&gt;</span> <span class="fu">NonEmptyChain</span><span class="op">(</span>message<span class="op">)))</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">validateUser</span><span class="op">(</span>username<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> email<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> password<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> Validated<span class="op">[</span>NonEmptyChain<span class="op">[</span><span class="ex">String</span><span class="op">],</span> User<span class="op">]</span> <span class="op">=</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  User<span class="op">.</span>curried<span class="op">.</span>pure<span class="op">[</span>Validated<span class="op">[</span>NonEmptyChain<span class="op">[</span><span class="ex">String</span><span class="op">],</span> <span class="op">*]]</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ap</span><span class="op">(</span><span class="fu">validateUsername</span><span class="op">(</span>username<span class="op">))</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ap</span><span class="op">(</span><span class="fu">validateEmail</span><span class="op">(</span>email<span class="op">))</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ap</span><span class="op">(</span><span class="fu">validatePassword</span><span class="op">(</span>password<span class="op">))</span></span></code></pre></div>
</div>
<p>Using this function, we can attempt to create a <code>User</code> with nothing but invalid data and get the complete collection of errors back:</p>
<div class="numberLines">
<div class="sourceCode" id="cb17"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> validatedUser <span class="op">=</span> <span class="fu">validateUser</span><span class="op">(</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  username <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  email <span class="op">=</span> <span class="st">&quot;bananaphone&quot;</span><span class="op">,</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  password <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n\t\r\r\r</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">inside</span><span class="op">(</span>validatedUser<span class="op">)</span> <span class="op">{</span> <span class="cf">case</span> <span class="ex">Invalid</span><span class="op">(</span>reasons<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>reasons<span class="op">.</span>toSeq should contain<span class="op">).</span><span class="fu">theSameElementsAs</span><span class="op">(</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Seq</span><span class="op">(</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Username can&#39;t be blank&quot;</span><span class="op">,</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Email does not appear to be valid&quot;</span><span class="op">,</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must have at least 8 characters&quot;</span><span class="op">,</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must contain at least one lowercase character&quot;</span><span class="op">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must contain at least one uppercase character&quot;</span><span class="op">,</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must contain at least one digit&quot;</span><span class="op">,</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must contain at least one symbol&quot;</span><span class="op">,</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>And with valid data, receive a constructed <code>User</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb18"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> validatedUser <span class="op">=</span> <span class="fu">validateUser</span><span class="op">(</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  username  <span class="op">=</span> <span class="st">&quot;commander.keen&quot;</span><span class="op">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  email <span class="op">=</span> <span class="st">&quot;commander.keen@vorticonexterminator.net&quot;</span><span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  password <span class="op">=</span> <span class="st">&quot;m4rti@an$Rul3&quot;</span><span class="op">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">inside</span><span class="op">(</span>validatedUser<span class="op">)</span> <span class="op">{</span> <span class="cf">case</span> <span class="fu">Valid</span><span class="op">(</span>user<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  user shouldBe <span class="fu">User</span><span class="op">(</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    username <span class="op">=</span> <span class="st">&quot;commander.keen&quot;</span><span class="op">,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    email <span class="op">=</span> <span class="st">&quot;commander.keen@vorticonexterminator.net&quot;</span><span class="op">,</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    password <span class="op">=</span> <span class="st">&quot;m4rti@an$Rul3&quot;</span><span class="op">,</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/ValidatedSpec.scala#L50-L141">See here</a> for the specs in the sample repository.</p>
</blockquote>
<p>Applicatives thus enable entire computations to succeed if all context arguments are in the <strong>desired case</strong>. If any argument is in the <strong>undesired case</strong>, then this case is <em>propagated</em> and the computation as a whole fails.</p>
<p>Each of <code>validateUsername()</code>, <code>validateEmail()</code>, and <code>validatePassword()</code> act as levers on whether a <code>User</code> is successfully produced. Writing specific if-statements to guide whether a <code>User</code> is produced or errors returned instead is not required: the <code>Applicative</code> typeclass succinctly abstracts away the necessary plumbing to control the flow of logic required to handle <strong>undesired cases</strong>. Errors are declared where they should occur and the abstraction handles the rest.</p>
<h3 id="independent-evaluation-of-contexts">Independent evaluation of contexts</h3>
<p>It may not have been obvious from <code>validateUser()</code>, but each validation function evaluates independently of the other validation functions. In the <code>Validation</code> context, this means that each function executes without impacting the other functions regardless of individual success or failure. Imagine for a moment, what if the functions were evaluated within an asynchronous context?</p>
<p>Let’s define a function on the <code>Applicative</code> typeclass that gathers the results of some effectful operations:</p>
<div class="numberLines">
<div class="sourceCode" id="cb19"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sequence<span class="op">[</span>A<span class="op">](</span>listFa<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>F<span class="op">[</span>A<span class="op">]]):</span> F<span class="op">[</span><span class="ex">List</span><span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  listFa<span class="op">.</span><span class="fu">foldLeft</span><span class="op">(</span><span class="fu">pure</span><span class="op">(</span><span class="ex">List</span><span class="op">[</span>A<span class="op">]()))((</span>fListA<span class="op">,</span> fa<span class="op">)</span> <span class="op">=&gt;</span> <span class="fu">map2</span><span class="op">(</span>fa<span class="op">,</span> fListA<span class="op">)(</span>_ <span class="op">::</span> _<span class="op">))</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/control/Applicative.scala#L83-L96">See here</a> for the definition in the sample repository.</p>
</blockquote>
<p>And then if we load three <code>User</code>s at once:</p>
<div class="numberLines">
<div class="sourceCode" id="cb20"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">loadUser</span><span class="op">(</span>email<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> <span class="ex">Future</span><span class="op">[</span>User<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> loadingUsers <span class="op">=</span> Applicative<span class="op">[</span><span class="ex">Future</span><span class="op">].</span><span class="fu">sequence</span><span class="op">(</span><span class="ex">List</span><span class="op">(</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadUser</span><span class="op">(</span><span class="st">&quot;test@email.com&quot;</span><span class="op">),</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadUser</span><span class="op">(</span><span class="st">&quot;student@school.edu&quot;</span><span class="op">),</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadUser</span><span class="op">(</span><span class="st">&quot;admin@foundation.net&quot;</span><span class="op">),</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">))</span></span></code></pre></div>
</div>
<p>The variable <code>loadingUsers</code> now contains <code>Future[List[User]]</code>. As each <code>Future[User]</code> resolves, they are collected into a <code>List</code>. Because each <code>loadUser()</code> function executes independently, this has a profound implication in the context of a <code>Future</code>: they are executed concurrently!</p>
<p>Should any <code>User</code> fail to load, the <strong>undesired case</strong> will <em>propagate</em> and the <code>sequence()</code> function will halt. <em>All other <code>User</code>s are discarded.</em></p>
<p>The pattern offered by <code>Applicative</code> is an <em>all-or-nothing</em> result in its output. If all inputs are in the <strong>desired case</strong>, then the output will be in the <strong>desired case</strong> as well. But if any are in an <strong>undesired case</strong>, then the <strong>undesired case</strong> <em>propagates</em> and computation halts.</p>
<h4 id="products-of-contexts">Products of contexts</h4>
<p>Given a 2-tuple of functors <code>(F[A], F[B])</code> you can invert the nesting of the context and the 2-tuple using the <code>pure()</code> and <code>ap()</code> functions from <code>Applicative</code> with the following steps:</p>
<div class="numberLines">
<div class="sourceCode" id="cb21"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="op">:</span>load console<span class="op">/</span>imports<span class="op">.</span>scala</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="kw">val</span> productOfSomes <span class="op">=</span> <span class="op">(</span><span class="ex">Option</span><span class="op">(</span><span class="dv">42</span><span class="op">),</span> <span class="ex">Option</span><span class="op">(</span><span class="st">&quot;banana&quot;</span><span class="op">))</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> productOfSomes<span class="op">:</span> <span class="op">(</span><span class="ex">Option</span><span class="op">[</span><span class="bu">Int</span><span class="op">],</span> <span class="ex">Option</span><span class="op">[</span><span class="ex">String</span><span class="op">])</span> <span class="op">=</span> <span class="op">(</span><span class="bu">Some</span><span class="op">(</span><span class="dv">42</span><span class="op">),</span> <span class="bu">Some</span><span class="op">(</span><span class="st">&quot;banana&quot;</span><span class="op">))</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="kw">val</span> someOfProduct <span class="op">=</span> <span class="op">(</span>_<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> _<span class="op">:</span> <span class="ex">String</span><span class="op">).</span>curried<span class="op">.</span>pure<span class="op">[</span><span class="ex">Option</span><span class="op">].</span><span class="fu">ap</span><span class="op">(</span>productOfSomes<span class="op">.</span>_1<span class="op">).</span><span class="fu">ap</span><span class="op">(</span>productOfSomes<span class="op">.</span>_2<span class="op">)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> someOfProduct<span class="op">:</span> <span class="ex">Option</span><span class="op">[(</span><span class="bu">Int</span><span class="op">,</span> <span class="ex">String</span><span class="op">)]</span> <span class="op">=</span> <span class="bu">Some</span><span class="op">((</span><span class="dv">42</span><span class="op">,</span> <span class="st">&quot;banana&quot;</span><span class="op">))</span></span></code></pre></div>
</div>
<p>This has an important implication, specifically that unlike the <code>sequence()</code> function these operations allow for gathering effectful operations that produce contexts with heterogeneous terms. Scala allows for tuples up to 22 elements, and it makes sense to abstract the above operations for each tuple size, especially because even at just 2 elements writing all of these out is already clunky!</p>
<p>In the sample repository, I have written a macro which <a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/macro/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/GenerateTupleSyntax.scala">adds two extension methods</a> to each tuple size. Here’s the code that is generated for the 2-tuple:</p>
<div class="numberLines">
<div class="sourceCode" id="cb22"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">class</span> Tuple2Ops<span class="op">[</span>F<span class="op">[</span>_<span class="op">],</span> T1<span class="op">,</span> T2<span class="op">](</span><span class="kw">val</span> t<span class="op">:</span> <span class="op">(</span>F<span class="op">[</span>T1<span class="op">],</span> F<span class="op">[</span>T2<span class="op">]))</span> <span class="kw">extends</span> AnyVal <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Converts a product of contexts `(F[T1], F[T2])` into a context of a product `F[(T1, T2)]`</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">tupled</span><span class="op">(</span><span class="kw">implicit</span> F<span class="op">:</span> Applicative<span class="op">[</span>F<span class="op">]):</span> F<span class="op">[(</span>T1<span class="op">,</span> T2<span class="op">)]</span> <span class="op">=</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapN</span><span class="op">(</span>Tuple2<span class="op">.</span>apply<span class="op">)</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Applies a product of contexts `(F[T1], F[T1])` to function, giving a result in context</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> mapN<span class="op">[</span>Out<span class="op">](</span>f<span class="op">:</span> <span class="op">(</span>T1<span class="op">,</span> T2<span class="op">)</span> <span class="op">=&gt;</span> Out<span class="op">)(</span><span class="kw">implicit</span> F<span class="op">:</span> Applicative<span class="op">[</span>F<span class="op">]):</span> F<span class="op">[</span>Out<span class="op">]</span> <span class="op">=</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    F<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>F<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>F<span class="op">.</span><span class="fu">pure</span><span class="op">(</span>f<span class="op">.</span>curried<span class="op">))(</span>t<span class="op">.</span>_1<span class="op">))(</span>t<span class="op">.</span>_2<span class="op">)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Being able to invert the nesting of a tuple and a context is most powerful when constructing case classes from arguments produced by effectful operations. By using the <code>mapN()</code> function, for example, validating arguments to the <code>User</code> constructor may be rewritten like this:</p>
<div class="numberLines">
<div class="sourceCode" id="cb23"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">validateUser</span><span class="op">(</span>username<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> email<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> password<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> Validated<span class="op">[</span>NonEmptyChain<span class="op">[</span><span class="ex">String</span><span class="op">],</span> User<span class="op">]</span> <span class="op">=</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateUsername</span><span class="op">(</span>username<span class="op">),</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateEmail</span><span class="op">(</span>email<span class="op">),</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validatePassword</span><span class="op">(</span>password<span class="op">)</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">).</span><span class="fu">mapN</span><span class="op">(</span>User<span class="op">)</span></span></code></pre></div>
</div>
<p>This syntax afforded by the <code>mapN()</code> extension method is much more concise and closely matches the constructor arguments order passed to <code>User</code> itself. After all, <code>User</code> is a product of results produced by contexts, which evaluate independently of each other as they do in the <code>sequence()</code> function.</p>
<h2 id="becoming-an-applicative">Becoming an Applicative</h2>
<p>In order to become an <code>Applicative</code>, an effect type must implement the typeclass. Let’s implement instances for the usual suspects, <code>Option</code>, <code>Either</code>, and <code>List</code>. As <code>Applicative</code> is a specialization of <code>Functor</code>, we can simply upgrade our current <code>Functor</code> instances to become <code>Applicative</code>s:</p>
<div class="numberLines">
<div class="sourceCode" id="cb24"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">val</span> optionApplicative<span class="op">:</span> Applicative<span class="op">[</span><span class="ex">Option</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> Applicative<span class="op">[</span><span class="ex">Option</span><span class="op">]</span> <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// removed map() and now using the default</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">override</span> <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> <span class="ex">Option</span><span class="op">[</span>A<span class="op">]</span> <span class="op">=</span> <span class="bu">Some</span><span class="op">(</span>a<span class="op">)</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">override</span> <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> <span class="ex">Option</span><span class="op">[</span>A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">]):</span> F<span class="op">[</span>B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>ff<span class="op">,</span> fa<span class="op">)</span> <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="op">(</span><span class="bu">Some</span><span class="op">(</span>f<span class="op">),</span> <span class="bu">Some</span><span class="op">(</span>a<span class="op">))</span> <span class="op">=&gt;</span> <span class="bu">Some</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span>a<span class="op">))</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> _ <span class="op">=&gt;</span> <span class="bu">None</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">def</span> eitherApplicative<span class="op">[</span>X<span class="op">]:</span> Applicative<span class="op">[</span>Either<span class="op">[</span>X<span class="op">,</span> <span class="op">*]]</span> <span class="op">=</span> <span class="kw">new</span> Applicative<span class="op">[</span>Either<span class="op">[</span>X<span class="op">,</span> <span class="op">*]]</span> <span class="op">{</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// removed map() and now using the default</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">override</span> <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> Either<span class="op">[</span>X<span class="op">,</span> A<span class="op">]</span> <span class="op">=</span> <span class="fu">Right</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">override</span> <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> Either<span class="op">[</span>X<span class="op">,</span> A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> F<span class="op">[</span>A<span class="op">]):</span> F<span class="op">[</span>B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>ff<span class="op">,</span> fa<span class="op">)</span> <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="op">(</span><span class="fu">Right</span><span class="op">(</span>f<span class="op">),</span> <span class="fu">Right</span><span class="op">(</span>a<span class="op">))</span> <span class="op">=&gt;</span> <span class="fu">Right</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span>a<span class="op">))</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="op">(</span><span class="fu">Left</span><span class="op">(</span>x<span class="op">),</span> _<span class="op">)</span> <span class="op">=&gt;</span> <span class="fu">Left</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="op">(</span>_<span class="op">,</span> <span class="fu">Left</span><span class="op">(</span>x<span class="op">))</span> <span class="op">=&gt;</span> <span class="fu">Left</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">val</span> listApplicative<span class="op">:</span> Applicative<span class="op">[</span><span class="ex">List</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> Applicative<span class="op">[</span><span class="ex">List</span><span class="op">]</span> <span class="op">{</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// removed map() and now using the default</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">override</span> <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> <span class="ex">List</span><span class="op">[</span>A<span class="op">]</span> <span class="op">=</span> <span class="ex">List</span><span class="op">(</span>a<span class="op">)</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">override</span> <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> <span class="ex">List</span><span class="op">[</span>A<span class="op">]):</span> <span class="ex">List</span><span class="op">[</span>B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    ff<span class="op">.</span><span class="fu">foldLeft</span><span class="op">(</span><span class="ex">List</span><span class="op">[</span>B<span class="op">]())</span> <span class="op">{</span> <span class="op">(</span>outerResult<span class="op">,</span> f<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>      fa<span class="op">.</span><span class="fu">foldLeft</span><span class="op">(</span>outerResult<span class="op">)</span> <span class="op">{</span> <span class="op">(</span>innerResult<span class="op">,</span> a<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">f</span><span class="op">(</span>a<span class="op">)</span> <span class="op">::</span> innerResult</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>reverse</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p>See the instances of <code>Applicative</code> for
<a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Option.scala#L159-L195"><code>Option</code></a>,
<a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/Either.scala#L114-L151"><code>Either</code></a>,
and <a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/main/scala/green/thisfieldwas/embracingnondeterminism/data/List.scala#L238-L275"><code>List</code></a> in the sample repository.</p>
</blockquote>
<p><code>Option</code> and <code>Either</code>’s instances of <code>Applicative</code> are straight-forward: if a function and argument are present, they are applied and the result returned in the <strong>desired case</strong>. If either are missing, then the <strong>undesired case</strong> is <em>propagated</em> instead.</p>
<p><code>List</code> looks very different at first glance, but conceptually performs the same way. Specifically, <code>List</code> performs a Cartesian product of its functions and arguments, applying each pair together and building a new <code>List</code> from the results. If either the function or argument <code>List</code> are empty, then an empty result <code>List</code> is returned, as an empty <code>List</code> represents the <strong>undesired case</strong>.</p>
<h2 id="applicative-laws">Applicative laws</h2>
<p><code>Option</code>, <code>Either</code>, and especially <code>List</code>’s <code>Applicative</code> instances look different. How do we know that they are well-behaved as applicatives? Just like functors, applicatives are expected to conform to a set of laws defined in the higher math of <a href="https://en.m.wikipedia.org/wiki/Category_theory">category theory</a>.</p>
<p>There are four applicative laws, which must hold for all applicatives in addition to the functor laws.</p>
<ol type="1">
<li><strong>Preservation of identity functions</strong>: A lifted identity function applied to a lifted argument is the same as the identity function applied directly to the lifted argument.</li>
<li><strong>Preservation of function homomorphism</strong>: Lifting a function and an argument then applying them produces the same result as applying the unlifted function and unlifted argument then lifting the result.</li>
<li><strong>Preservation of function interchange</strong>: Given a lifted function and an unlifted argument, applying the lifted function after lifting the argument should give the same result as when reversing the order of the function and argument. This is difficult to express in words, and the code is hard to follow, but roughly this translates to <code>ap(ff: F[A =&gt; B])(pure(a)) == ap(pure(f =&gt; f(a)))(ff)</code>.</li>
<li><strong>Preservation of function composition</strong>: Given lifted functions <code>ff: F[A =&gt; B]</code> and <code>fg: F[B =&gt; C]</code> and argument <code>fa: F[A]</code>: lifting <code>compose()</code> and applying <code>fg</code>, <code>ff</code>, and <code>fa</code> produces the same result as applying <code>fg</code> after applying <code>ff</code> to <code>fa</code>.</li>
</ol>
<p>These laws are rigorous and we can write tests for these to prove that our applicative instances are defined correctly.</p>
<h3 id="testing-for-all-f_">Testing “for all” <code>F[_]</code></h3>
<p>In order to properly test our applicative instances, we need to be able to generate a broad range of inputs to verify that the applicative properties hold with a high degree of confidence. Specifically, “for all” <code>List</code>s, for example, the property checks for <code>Applicative</code> must pass for each generated instance. We will leverage <code>scalacheck</code> for property-based testing. <code>scalacheck</code> will generate for us a set of arbitrary instances of the contexts and execute tests called <em>property checks</em> against each to verify that each check passes. If all checks pass, then the property may be considered to hold “for all” instances of the tested context.</p>
<p>Generating an arbitrary context <code>F[_]</code> containing an arbitrary <code>A</code> is not supported directly by <code>scalacheck</code>, however. We can leverage this typeclass below to enable generating instances of <code>F[A]</code> from any generator for <code>A</code>:</p>
<div class="numberLines">
<div class="sourceCode" id="cb25"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> org<span class="op">.</span>scalacheck<span class="op">.</span>Gen</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> LiftedGen<span class="op">[</span>F<span class="op">[</span>_<span class="op">]]</span> <span class="op">{</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span>F<span class="op">[</span>A<span class="op">]]</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a> <span class="kw">object</span> LiftedGen <span class="op">{</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> apply<span class="op">[</span>F<span class="op">[</span>_<span class="op">]:</span> LiftedGen<span class="op">]:</span> LiftedGen<span class="op">[</span>F<span class="op">]</span> <span class="op">=</span> implicitly<span class="op">[</span>LiftedGen<span class="op">[</span>F<span class="op">]]</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">object</span> Syntax <span class="op">{</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>     <span class="kw">implicit</span> <span class="kw">class</span> LiftedGenOps<span class="op">[</span>A<span class="op">](</span><span class="kw">val</span> gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">])</span> <span class="kw">extends</span> AnyVal <span class="op">{</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>       <span class="kw">def</span> lift<span class="op">[</span>F<span class="op">[</span>_<span class="op">]:</span> LiftedGen<span class="op">]:</span> Gen<span class="op">[</span>F<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span> LiftedGen<span class="op">[</span>F<span class="op">].</span>lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">)</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/util/LiftedGen.scala">See here</a> for the definition in the sample repository.</p>
</blockquote>
<h3 id="defining-the-applicative-laws-as-properties">Defining the applicative laws as properties</h3>
<p>Now we will walk through defining the properties of <code>Applicative</code> in such a way that we simply supply the contexts as the argument to the test. This way we only define the properties once.</p>
<div class="numberLines">
<div class="sourceCode" id="cb26"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> ApplicativeLaws <span class="op">{</span> <span class="kw">this</span><span class="op">:</span> Laws <span class="kw">with</span> FunctorLaws <span class="op">=&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span> Defined per Applicative laws taken from the Haskell wiki<span class="co">:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> <span class="co">[[</span>https<span class="co">://</span>en<span class="co">.</span>wikibooks<span class="co">.</span>org<span class="co">/</span>wiki<span class="co">/</span>Haskell<span class="co">/</span>Applicative_functors<span class="co">#</span>Applicative_functor_laws<span class="co">]]</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> These laws extend the functor laws<span class="co">,</span> so <span class="co">`</span>checkFunctorLaws<span class="co">[</span>F<span class="co">]()`</span> should be</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> executed alongside this function<span class="co">.</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> <span class="co">@</span>param TT The type tag of the context</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> <span class="co">@</span>tparam F The context type being tested</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">*/</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> checkApplicativeLaws<span class="op">[</span>F<span class="op">[</span>_<span class="op">]:</span> Applicative<span class="op">:</span> LiftedGen<span class="op">]()(</span><span class="kw">implicit</span> TT<span class="op">:</span> TypeTag<span class="op">[</span>F<span class="op">[</span><span class="ex">Any</span><span class="op">]]):</span> <span class="bu">Unit</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">property</span><span class="op">(</span><span class="ss">s&quot;${</span>TT<span class="op">.</span>name<span class="ss">}</span><span class="st"> Applicative preserves identity functions</span><span class="ss">&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// A lifted identity function applied to a lifted argument is the same as</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the identity function applied directly to the lifted argument.</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">forAll</span><span class="op">(</span>arbitrary<span class="op">[</span><span class="ex">Double</span><span class="op">].</span>lift<span class="op">)</span> <span class="op">{</span> v <span class="op">=&gt;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Haskell: pure id &lt;*&gt; v = v</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>identity<span class="op">[</span><span class="ex">Double</span><span class="op">]</span> _<span class="op">).</span>pure<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>v<span class="op">)</span> mustBe <span class="fu">identity</span><span class="op">(</span>v<span class="op">)</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">property</span><span class="op">(</span><span class="ss">s&quot;${</span>TT<span class="op">.</span>name<span class="ss">}</span><span class="st"> Applicative preserves function homomorphism</span><span class="ss">&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Lifting a function and an argument then applying them produces the</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">// same result as applying the unlifted function and unlifted argument</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// then lifting the result.</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">forAll</span><span class="op">(</span><span class="cf">for</span> <span class="op">{</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        f <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">Double</span> <span class="op">=&gt;</span> <span class="ex">String</span><span class="op">]</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        x <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">Double</span><span class="op">]</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">yield</span> <span class="op">(</span>f<span class="op">,</span> x<span class="op">))</span> <span class="op">{</span> <span class="cf">case</span> <span class="op">(</span>f<span class="op">,</span> x<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Haskell: pure f &lt;*&gt; pure x = pure (f x)</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        f<span class="op">.</span>pure<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>x<span class="op">.</span>pure<span class="op">)</span> mustBe <span class="fu">f</span><span class="op">(</span>x<span class="op">).</span>pure</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">property</span><span class="op">(</span><span class="ss">s&quot;${</span>TT<span class="op">.</span>name<span class="ss">}</span><span class="st"> Applicative preserves function interchange</span><span class="ss">&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Given a lifted function and an unlifted argument, applying the lifted</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">// function after lifting the argument should give the same result as</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// when reversing the order of the function and argument. This is</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">// difficult to express in words, and the code is hard to follow, but</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>      <span class="co">// roughly this translates to</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">// `ap(ff: F[A =&gt; B])(pure(a)) == ap(pure(f =&gt; f(a)))(ff)`.</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">forAll</span><span class="op">(</span><span class="cf">for</span> <span class="op">{</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>        u <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">Double</span> <span class="op">=&gt;</span> <span class="ex">String</span><span class="op">].</span>lift</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>        y <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">Double</span><span class="op">]</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">yield</span> <span class="op">(</span>u<span class="op">,</span> y<span class="op">))</span> <span class="op">{</span> <span class="cf">case</span> <span class="op">(</span>u<span class="op">,</span> y<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Haskell: u &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>        u<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>y<span class="op">.</span>pure<span class="op">)</span> <span class="fu">mustBe</span> <span class="op">((</span>f<span class="op">:</span> <span class="ex">Double</span> <span class="op">=&gt;</span> <span class="ex">String</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="fu">f</span><span class="op">(</span>y<span class="op">)).</span>pure<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>u<span class="op">)</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">property</span><span class="op">(</span><span class="ss">s&quot;${</span>TT<span class="op">.</span>name<span class="ss">}</span><span class="st"> Applicative preserves function composition</span><span class="ss">&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Given lifted functions `ff: F[A =&gt; B]` and `fg: F[B =&gt; C]` and</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">// argument `fa: F[A]`: lifting `compose()` and applying `fg`, `ff`, and</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">// `fa` produces the same result as applying `fg` after applying `ff` to</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">// `fa`.</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">val</span> compose<span class="op">:</span> <span class="op">(</span><span class="ex">String</span> <span class="op">=&gt;</span> <span class="bu">Int</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="op">(</span><span class="ex">Double</span> <span class="op">=&gt;</span> <span class="ex">String</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="ex">Double</span> <span class="op">=&gt;</span> <span class="bu">Int</span> <span class="op">=</span> g <span class="op">=&gt;</span> f <span class="op">=&gt;</span> g compose f</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">forAll</span><span class="op">(</span><span class="cf">for</span> <span class="op">{</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>        u <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">String</span> <span class="op">=&gt;</span> <span class="bu">Int</span><span class="op">].</span>lift</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>        v <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">Double</span> <span class="op">=&gt;</span> <span class="ex">String</span><span class="op">].</span>lift</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>        w <span class="op">&lt;-</span> arbitrary<span class="op">[</span><span class="ex">Double</span><span class="op">].</span>lift</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">yield</span> <span class="op">(</span>u<span class="op">,</span> v<span class="op">,</span> w<span class="op">))</span> <span class="op">{</span> <span class="cf">case</span> <span class="op">(</span>u<span class="op">,</span> v<span class="op">,</span> w<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Haskell: pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w = u &lt;*&gt; (v &lt;*&gt; w)</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>        compose<span class="op">.</span>pure<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>u<span class="op">).</span><span class="fu">ap</span><span class="op">(</span>v<span class="op">).</span><span class="fu">ap</span><span class="op">(</span>w<span class="op">)</span> mustBe u<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>v<span class="op">.</span><span class="fu">ap</span><span class="op">(</span>w<span class="op">))</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p><a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/control/ApplicativeLaws.scala">See here</a> for the full definition of the trait.</p>
</blockquote>
<p>With this trait, laws specs can be written for each context.</p>
<div class="numberLines">
<div class="sourceCode" id="cb27"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">abstract</span> <span class="kw">class</span> Laws <span class="kw">extends</span> AnyPropSpec <span class="kw">with</span> ScalaCheckPropertyChecks <span class="kw">with</span> Matchers <span class="op">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">override</span> <span class="kw">val</span> generatorDrivenConfig<span class="op">:</span> PropertyCheckConfiguration <span class="op">=</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PropertyCheckConfiguration</span><span class="op">(</span>minSuccessful <span class="op">=</span> <span class="dv">100</span><span class="op">)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OptionLawsSpec <span class="kw">extends</span> Laws <span class="kw">with</span> FunctorLaws <span class="kw">with</span> ApplicativeLaws <span class="op">{</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> <span class="ex">Option</span><span class="op">.</span>Instances<span class="op">.</span>_</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">val</span> optionLiftedGen<span class="op">:</span> LiftedGen<span class="op">[</span><span class="ex">Option</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> LiftedGen<span class="op">[</span><span class="ex">Option</span><span class="op">]</span> <span class="op">{</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span><span class="ex">Option</span><span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>      Gen<span class="op">.</span><span class="fu">lzy</span><span class="op">(</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        Gen<span class="op">.</span><span class="fu">oneOf</span><span class="op">(</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>          gen<span class="op">.</span><span class="fu">map</span><span class="op">(</span><span class="bu">Some</span><span class="op">(</span>_<span class="op">)),</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>          Gen<span class="op">.</span><span class="fu">const</span><span class="op">(</span><span class="bu">None</span><span class="op">),</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>      <span class="op">)</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  checkFunctorLaws<span class="op">[</span><span class="ex">Option</span><span class="op">]()</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  checkApplicativeLaws<span class="op">[</span><span class="ex">Option</span><span class="op">]()</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EitherLawsSpec <span class="kw">extends</span> Laws <span class="kw">with</span> FunctorLaws <span class="kw">with</span> ApplicativeLaws <span class="op">{</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> Either<span class="op">.</span>Instances<span class="op">.</span>_</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">def</span> eitherLiftedGen<span class="op">[</span>X<span class="op">:</span> Arbitrary<span class="op">]:</span> LiftedGen<span class="op">[</span>Either<span class="op">[</span>X<span class="op">,</span> <span class="op">*]]</span> <span class="op">=</span> <span class="kw">new</span> LiftedGen<span class="op">[</span>Either<span class="op">[</span>X<span class="op">,</span> <span class="op">*]]</span> <span class="op">{</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span>Either<span class="op">[</span>X<span class="op">,</span> A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>      Gen<span class="op">.</span><span class="fu">lzy</span><span class="op">(</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>        Gen<span class="op">.</span><span class="fu">oneOf</span><span class="op">(</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>          gen<span class="op">.</span><span class="fu">map</span><span class="op">(</span><span class="fu">Right</span><span class="op">(</span>_<span class="op">)),</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>          arbitrary<span class="op">[</span>X<span class="op">].</span><span class="fu">map</span><span class="op">(</span><span class="fu">Left</span><span class="op">(</span>_<span class="op">)),</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>      <span class="op">)</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>  checkFunctorLaws<span class="op">[</span>Either<span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="op">*]]()</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>  checkApplicativeLaws<span class="op">[</span>Either<span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="op">*]]()</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ListLawsSpec <span class="kw">extends</span> Laws <span class="kw">with</span> FunctorLaws <span class="kw">with</span> ApplicativeLaws <span class="op">{</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> <span class="ex">List</span><span class="op">.</span>Instances<span class="op">.</span>_</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">val</span> listLiftedGen<span class="op">:</span> LiftedGen<span class="op">[</span><span class="ex">List</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> LiftedGen<span class="op">[</span><span class="ex">List</span><span class="op">]</span> <span class="op">{</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span><span class="ex">List</span><span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">{</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>        size <span class="op">&lt;-</span> Gen<span class="op">.</span><span class="fu">sized</span><span class="op">(</span>Gen<span class="op">.</span><span class="fu">choose</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> _<span class="op">))</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>        items <span class="op">&lt;-</span> Gen<span class="op">.</span><span class="fu">listOfN</span><span class="op">(</span>size<span class="op">,</span> gen<span class="op">)</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">yield</span> <span class="ex">List</span><span class="op">(</span>items<span class="op">:</span> _<span class="op">*)</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>  checkFunctorLaws<span class="op">[</span><span class="ex">List</span><span class="op">]()</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>  checkApplicativeLaws<span class="op">[</span><span class="ex">List</span><span class="op">]()</span></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p>See these laws specs for
<a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/OptionSpec.scala#L127-L145"><code>Option</code></a>,
<a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/EitherSpec.scala#L112-L135"><code>Either</code></a>,
and <a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/ListSpec.scala#L159-L180"><code>List</code></a> in the sample repository.</p>
</blockquote>
<p><em>Try running these specs!</em></p>
<h4 id="but-dont-forget-validated">But don’t forget <code>Validated</code>!</h4>
<p>We also defined an <code>Applicative</code> instance for <code>Validated</code> above:</p>
<div class="numberLines">
<div class="sourceCode" id="cb28"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">implicit</span> <span class="kw">def</span> validatedApplicative<span class="op">[</span>E<span class="op">:</span> Semigroup<span class="op">]:</span> Applicative<span class="op">[</span>Validated<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">=</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> Applicative<span class="op">[</span>Validated<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">{</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> Semigroup<span class="op">.</span>Syntax<span class="op">.</span>_</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">](</span>a<span class="op">:</span> A<span class="op">):</span> Validated<span class="op">[</span>E<span class="op">,</span> A<span class="op">]</span> <span class="op">=</span> <span class="fu">Valid</span><span class="op">(</span>a<span class="op">)</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> ap<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>ff<span class="op">:</span> Validated<span class="op">[</span>E<span class="op">,</span> A <span class="op">=&gt;</span> B<span class="op">])(</span>fa<span class="op">:</span> Validated<span class="op">[</span>E<span class="op">,</span> A<span class="op">]):</span> Validated<span class="op">[</span>E<span class="op">,</span> B<span class="op">]</span> <span class="op">=</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>ff<span class="op">,</span> fa<span class="op">)</span> <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="fu">Valid</span><span class="op">(</span>f<span class="op">),</span> <span class="fu">Valid</span><span class="op">(</span>a<span class="op">))</span>     <span class="op">=&gt;</span> <span class="fu">Valid</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span>a<span class="op">))</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>x<span class="op">),</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">))</span> <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>x <span class="op">|+|</span> y<span class="op">)</span> <span class="co">// propagate both undesired cases via Semigroup</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>x<span class="op">),</span> _<span class="op">)</span>          <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span>_<span class="op">,</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">))</span>          <span class="op">=&gt;</span> <span class="ex">Invalid</span><span class="op">(</span>y<span class="op">)</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div>
</div>
<p>This instance should be tested as well:</p>
<div class="numberLines">
<div class="sourceCode" id="cb29"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidatedLawsSpec <span class="kw">extends</span> Laws <span class="kw">with</span> FunctorLaws <span class="kw">with</span> ApplicativeLaws <span class="op">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> Validated<span class="op">.</span>Instances<span class="op">.</span>_</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> NonEmptyChain<span class="op">.</span>Instances<span class="op">.</span>_</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">val</span> nonEmptyChainLiftedGen<span class="op">:</span> LiftedGen<span class="op">[</span>NonEmptyChain<span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> LiftedGen<span class="op">[</span>NonEmptyChain<span class="op">]</span> <span class="op">{</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> <span class="fu">go</span><span class="op">(</span>depth<span class="op">:</span> <span class="bu">Int</span><span class="op">):</span> Gen<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        Gen<span class="op">.</span><span class="fu">choose</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="op">(</span>depth <span class="op">-</span> <span class="dv">1</span><span class="op">).</span><span class="fu">max</span><span class="op">(</span><span class="dv">0</span><span class="op">)).</span>flatMap <span class="op">{</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>          <span class="cf">case</span> <span class="dv">0</span> <span class="op">=&gt;</span> gen<span class="op">.</span><span class="fu">map</span><span class="op">(</span><span class="fu">NonEmptyChain</span><span class="op">(</span>_<span class="op">))</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>          <span class="cf">case</span> nextDepth <span class="op">=&gt;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">{</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>              prefix <span class="op">&lt;-</span> <span class="fu">go</span><span class="op">(</span>nextDepth<span class="op">)</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>              suffix <span class="op">&lt;-</span> <span class="fu">go</span><span class="op">(</span>nextDepth<span class="op">)</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">yield</span> prefix<span class="op">.</span><span class="fu">append</span><span class="op">(</span>suffix<span class="op">)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>      Gen<span class="op">.</span><span class="fu">sized</span><span class="op">(</span>go<span class="op">)</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">def</span> validatedNecLiftedGen<span class="op">[</span>E<span class="op">:</span> Arbitrary<span class="op">]:</span> LiftedGen<span class="op">[</span>ValidatedNec<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">=</span> <span class="kw">new</span> LiftedGen<span class="op">[</span>ValidatedNec<span class="op">[</span>E<span class="op">,</span> <span class="op">*]]</span> <span class="op">{</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span>ValidatedNec<span class="op">[</span>E<span class="op">,</span> A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>      Gen<span class="op">.</span><span class="fu">lzy</span><span class="op">(</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        Gen<span class="op">.</span><span class="fu">oneOf</span><span class="op">(</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>          arbitrary<span class="op">[</span>E<span class="op">].</span>lift<span class="op">[</span>NonEmptyChain<span class="op">].</span><span class="fu">map</span><span class="op">(</span><span class="ex">Invalid</span><span class="op">(</span>_<span class="op">)),</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>          gen<span class="op">.</span><span class="fu">map</span><span class="op">(</span><span class="fu">Valid</span><span class="op">(</span>_<span class="op">)),</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>      <span class="op">)</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  checkFunctorLaws<span class="op">[</span>ValidatedNec<span class="op">[</span><span class="ex">Exception</span><span class="op">,</span> <span class="op">*]]()</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>  checkApplicativeLaws<span class="op">[</span>ValidatedNec<span class="op">[</span><span class="ex">Exception</span><span class="op">,</span> <span class="op">*]]()</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>And we should also make sure <code>NonEmptyChain</code> is well-behaved as a semigroup:</p>
<div class="numberLines">
<div class="sourceCode" id="cb30"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NonEmptyChainLaws <span class="kw">extends</span> Laws <span class="kw">with</span> SemigroupLaws <span class="op">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> NonEmptyChain<span class="op">.</span>Instances<span class="op">.</span>_</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">val</span> nonEmptyChainLiftedGen<span class="op">:</span> LiftedGen<span class="op">[</span>NonEmptyChain<span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> LiftedGen<span class="op">[</span>NonEmptyChain<span class="op">]</span> <span class="op">{</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">def</span> lift<span class="op">[</span>A<span class="op">](</span>gen<span class="op">:</span> Gen<span class="op">[</span>A<span class="op">]):</span> Gen<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> <span class="fu">go</span><span class="op">(</span>depth<span class="op">:</span> <span class="bu">Int</span><span class="op">):</span> Gen<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        Gen<span class="op">.</span><span class="fu">choose</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="op">(</span>depth <span class="op">-</span> <span class="dv">1</span><span class="op">).</span><span class="fu">max</span><span class="op">(</span><span class="dv">0</span><span class="op">)).</span>flatMap <span class="op">{</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>          <span class="cf">case</span> <span class="dv">0</span> <span class="op">=&gt;</span> gen<span class="op">.</span><span class="fu">map</span><span class="op">(</span><span class="fu">NonEmptyChain</span><span class="op">(</span>_<span class="op">))</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>          <span class="cf">case</span> nextDepth <span class="op">=&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">{</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>              prefix <span class="op">&lt;-</span> <span class="fu">go</span><span class="op">(</span>nextDepth<span class="op">)</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>              suffix <span class="op">&lt;-</span> <span class="fu">go</span><span class="op">(</span>nextDepth<span class="op">)</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">yield</span> prefix<span class="op">.</span><span class="fu">append</span><span class="op">(</span>suffix<span class="op">)</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>      Gen<span class="op">.</span><span class="fu">sized</span><span class="op">(</span>go<span class="op">)</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">implicit</span> <span class="kw">def</span> arbitraryNonEmptyChain<span class="op">[</span>A<span class="op">:</span> Arbitrary<span class="op">]:</span> Arbitrary<span class="op">[</span>NonEmptyChain<span class="op">[</span>A<span class="op">]]</span> <span class="op">=</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Arbitrary</span><span class="op">(</span>nonEmptyChainLiftedGen<span class="op">.</span><span class="fu">lift</span><span class="op">(</span>arbitrary<span class="op">[</span>A<span class="op">]))</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  checkSemigroupLaws<span class="op">[</span>NonEmptyChain<span class="op">[</span><span class="bu">Int</span><span class="op">]]()</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<blockquote>
<p>See these laws specs for
<a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/ValidatedSpec.scala#L144-L170"><code>Validated</code></a>
and <a href="https://bitsof.thisfieldwas.green/keywordsalad/embracing-nondeterminism-code/src/branch/part2/src/test/scala/green/thisfieldwas/embracingnondeterminism/data/NonEmptyChainSpec.scala#L94-L102"><code>NonEmptyChain</code></a></p>
</blockquote>
<h3 id="implications-of-the-applicative-laws">Implications of the applicative laws</h3>
<p>Each of <code>Option</code>, <code>Either</code>, and <code>List</code> conform to the applicative laws and we only had to write the properties once. These properties prove that functions and arguments used within these contexts maintain referential transparency in their arrangements and that the specific contexts do not change the factoring semantics of the code.</p>
<p>What does change, however, are these contexts’ specific effects. For example, you would not have to refactor code abstracted by applicative functions if you changed the backing implementation from <code>Either</code> to <code>List</code>, but your code would produce potentially more than one result in the <strong>desired case</strong>.</p>
<p>This is the goal, however, as these effects’ dimensions of unknown quantity should not burden our code. Instead, we push the complexity to the edge of the context, where it is important that our context is an <code>Either</code> or a <code>List</code>, and keep our business logic focused on individual instances contained within each context.</p>
<h2 id="what-is-enabled-by-applicatives">What is enabled by applicatives?</h2>
<p>Applicatives primarily offer independent computation. Specifically, the arguments to applicative functions such as <code>ap()</code>, <code>map2()</code>, or <code>sequence()</code> are evaluated independently of one another, and their individual outputs as a whole influence whether the functions consuming them are permitted to compute against the outputs of their <strong>desired cases</strong> or if they should halt computation and <em>propagate</em> any <strong>undesired cases</strong>.</p>
<p>When all inputs to an applicative function are in the <strong>desired case</strong>, then the output of the lifted functions will also be in the <strong>desired case</strong>. Conversely, if any input is in the <strong>undesired case</strong>, then it will be propagated instead, and the other cases will be <em>discarded</em>. In this regard, applicative functions provide an <em>all-or-nothing</em> operation.</p>
<p>Independent computation provides some level of control flow, but it doesn’t guide execution to proceed only if the previous execution has succeeded, as all operations evaluate independently of each other. Applicatives therefore do not provide a mechanism to support imperative programming. For this kind of control flow, you need to further specialize the applicative functor.</p>
<p>In my next post <a href="/blog/2022/06/17/imperative-computation/" title="Imperative Computation in Functional Programming">Imperative Computation in Functional Programming</a> we will explore the infamous <em><strong>monad</strong></em> and how it enables imperative control flow in functional programming.</p>

    </div>
    <div class="page-comments">
  <p><strong>Please share with me your thoughts and feedback!</strong></p>
  <script>
    var remark_config = {
      host: 'https://remark42.thisfieldwas.green',
      site_id: 'thisfieldwas.green',
      url: 'https://thisfieldwas.green/blog/2022/06/05/enabling-control-flow/'
    }
  </script>
  <script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)} }(remark_config.components||["embed"],document);</script>
  <div id="remark42"></div>
</div>

  </div>
</main>

<footer class="page-footer">
  <div class="content-bound">
    <nav class="main-nav">
  <a href="/">Home</a>
  <a href="/blog/">Blog</a>
  <a href="/resume/">Resume</a>
  <a href="/contact/">Contact</a>
</nav>

    <p class="copyright">Copyright &copy; <span class="copyright-date">2012</span> Logan McGrath. All rights reserved.</p>
    <ul class="acks">
      <li>Site proudly generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>.</li>
      <li><a href="https://www.flaticon.com/free-icon/grass_2790190">Icon</a> made by <a href="https://www.flaticon.com/authors/good-ware">Good Ware</a> from <a href="https://www.flaticon.com/">Flaticon</a>.</li>
    </ul>
    <p class="generated">This page was rendered from <a href="https://bitsof.thisfieldwas.green/keywordsalad/thisfieldwas.green/src/commit/76883e1/site/_posts/2022-06-05-enabling-control-flow.md">2022-06-05-enabling-control-flow.md</a> at commit <a class="commit-link" href="https://bitsof.thisfieldwas.green/keywordsalad/thisfieldwas.green/src/commit/76883e1">76883e1</a>.</p>
  </div>
</footer>

</body>
</html>
